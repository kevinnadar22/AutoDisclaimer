<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smoking Detection & Disclaimer Adder</title>
    <!-- URL Prefix for API endpoints -->
    <meta name="url-prefix" content="{{ url_prefix }}">
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="mb-8 text-center app-header py-4 rounded-lg">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Smoking Detection & Disclaimer Adder</h1>
            <p class="text-gray-600">Upload a video to detect smoking and add disclaimers</p>
        </header>

        <main>
            <!-- Step 1: Upload Video -->
            <div id="step1" class="bg-white rounded-lg shadow-md p-6 mb-6 step-container">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Step 1: Upload Video</h2>

                <div id="videoDropZone" class="drop-zone rounded-lg p-8 text-center cursor-pointer">
                    <div class="flex flex-col items-center">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-3"></i>
                        <p class="text-gray-700 mb-2">Drag and drop your video here or click to browse</p>
                        <p class="text-sm text-gray-500">Supports MP4, AVI, MOV, MKV</p>
                    </div>
                    <input type="file" id="videoInput" class="hidden"
                        accept="video/mp4,video/avi,video/quicktime,video/x-matroska">
                </div>

                <div id="videoPreview" class="mt-4 hidden">
                    <div class="flex items-center">
                        <i class="fas fa-video text-green-500 mr-2"></i>
                        <span id="videoName" class="text-gray-700 font-medium"></span>
                        <button id="removeVideo" class="ml-auto text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <video id="videoPlayer" class="w-full max-w-md h-auto max-h-48 mt-3 rounded object-contain mx-auto" controls></video>
                </div>
            </div>

            <!-- Step 2: Configure Settings -->
            <div id="step2" class="bg-white rounded-lg shadow-md p-6 mb-6 opacity-50 step-container">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Step 2: Configure Settings</h2>

                <div class="mb-4">
                    <label for="framesPerSecond" class="block text-gray-700 mb-2">Frames per second to analyze</label>
                    <div class="flex items-center">
                        <input type="range" id="framesPerSecond" min="1" max="24" value="1" class="w-full mr-4">
                        <span id="framesValue" class="text-gray-700 font-medium">1</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">Higher values provide more accurate detection but increase
                        processing time</p>
                </div>

                <div class="mt-6">
                    <label class="block text-gray-700 mb-2">Disclaimer Image (optional)</label>
                    <div id="disclaimerDropZone" class="drop-zone rounded-lg p-6 text-center cursor-pointer">
                        <div class="flex flex-col items-center">
                            <i class="fas fa-image text-3xl text-blue-500 mb-2"></i>
                            <p class="text-gray-700 mb-1">Drag and drop an image or click to browse</p>
                            <p class="text-sm text-gray-500">Supports PNG, JPG, JPEG</p>
                        </div>
                        <input type="file" id="disclaimerInput" class="hidden" accept="image/png,image/jpeg,image/jpg">
                    </div>

                    <div id="disclaimerPreview" class="mt-4 hidden">
                        <div class="flex items-center">
                            <i class="fas fa-image text-green-500 mr-2"></i>
                            <span id="disclaimerName" class="text-gray-700 font-medium"></span>
                            <button id="removeDisclaimer" class="ml-auto text-red-500 hover:text-red-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="flex justify-center">
                            <img id="disclaimerImage" class="mt-3 max-h-32 max-w-xs rounded object-contain" alt="Disclaimer preview">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Process Video -->
            <div id="step3" class="bg-white rounded-lg shadow-md p-6 mb-6 opacity-50 step-container">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Step 3: Process Video</h2>

                <button id="processButton"
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                    <i class="fas fa-play mr-2"></i>Process Video
                </button>

                <div id="processingStatus" class="mt-6 hidden">
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <span id="currentStep" class="text-gray-700 font-medium">Extracting frames...</span>
                            <span id="progressPercent" class="text-gray-700">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="progressBar" class="progress-bar bg-blue-500 h-2.5 rounded-full" style="width: 0%">
                            </div>
                        </div>
                    </div>

                    <div id="statusDetails" class="text-sm text-gray-600 mb-4">
                        <p id="statusText">Initializing...</p>
                    </div>
                </div>
            </div>

            <!-- Step 4: Results -->
            <div id="step4" class="bg-white rounded-lg shadow-md p-6 mb-6 hidden step-container">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Results</h2>

                <div id="processingComplete" class="mb-6">
                    <div class="flex items-center text-green-500 mb-4">
                        <i class="fas fa-check-circle text-2xl mr-2"></i>
                        <span class="text-lg font-medium">Processing Complete!</span>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-medium text-gray-700 mb-2">Processing Summary</h3>
                        <ul class="space-y-1 text-gray-600">
                            <li id="totalFrames">• Total frames analyzed: 0</li>
                            <li id="smokingFrames">• Smoking detected in: 0 frames (0%)</li>
                            <li id="framesPerSecondResult">• Frames per second analyzed: 1</li>
                            <li id="fileSize">• Output file size: 0 MB</li>
                        </ul>
                    </div>

                    <button id="downloadButton"
                        class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg mb-4 transition-colors">
                        <i class="fas fa-download mr-2"></i>Download Processed Video
                    </button>

                    <div id="resultVideoContainer" class="mt-4">
                        <h3 class="font-medium text-gray-700 mb-2">Video Preview</h3>
                        <video id="resultVideo" class="w-full rounded" controls></video>
                    </div>
                </div>
            </div>
        </main>

        <div id="errorAlert" class="fixed bottom-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg hidden">
            <div class="flex items-start">
                <i class="fas fa-exclamation-circle text-xl mr-2"></i>
                <div>
                    <h3 class="font-bold">Error</h3>
                    <p id="errorMessage"></p>
                </div>
                <button id="closeError" class="ml-4 text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>